### docker环境下的安装


##### 1. 拉取zookeeper镜像
```
docker pull wurstmeister/zookeeper
```

##### 2. 拉取kafka镜像
```
docker pull wurstmeister/kafka
```

##### 3. 启动zookeeper容器
```
docker run -d --name zookeeper -p 2181:2181 -t wurstmeister/zookeeper
```
##### 4. 启动kafka容器
```
docker run  -d -m 512M --name kafka -p 9092:9092 -e KAFKA_BROKER_ID=0 -e KAFKA_ZOOKEEPER_CONNECT=172.16.150.85:2181 -e KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://121.199.36.219:9092 -e KAFKA_LISTENERS=PLAINTEXT://0.0.0.0:9092 -t wurstmeister/kafka
```

docker run  -d --name kafka \
-p 9092:9092 \
-e KAFKA_BROKER_ID=0 \
-e KAFKA_ZOOKEEPER_CONNECT=192.168.1.1:2181 \
-e KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://192.168.1.1:9092 \
-e KAFKA_LISTENERS=PLAINTEXT://0.0.0.0:9092 -t wurstmeister/kafka

中间两个参数的192.168.1.1改为宿主机器的IP,如ipconfig查看的IPV4地址，如果不这么设置，可能会导致在别的机器上访问不到kafka。

搭建集群只需:创建多个容器,用不同的端口和不同的KAFKA_BROKER_ID即可

docker run -d --name kafka1 \
-p 9093:9093 \
-e KAFKA_BROKER_ID=1 \
-e KAFKA_ZOOKEEPER_CONNECT=<宿主机IP>:2181 \
-e KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://<宿主机IP>:9093 \
-e KAFKA_LISTENERS=PLAINTEXT://0.0.0.0:9093 -t wurstmeister/kafka
##### 5. 检查镜像启动
```
docker ps
可查看正在运行的镜像
```
##### 6. 进入kafka容器
```
进入kafka所在目录
docker exec -ti kafka /bin/bash
进入kafka所在目录
cd opt/kafka_2.12-1.1.0/
```
##### 7. 测试卡夫卡消息

###### 7.1 创建主题
```
bin/kafka-topics.sh --create --zookeeper 192.168.1.5:2181 --replication-factor 1 --partitions 3 --topic bjstestkafka
```
显示
```
Created topic bjstestkafka.
```

###### 7.2 查看主题
```
bin/kafka-topics.sh --describe --zookeeper 192.168.1.5:2181 --topic bjstestkafka
```
显示
```
Topic: bjstestkafka     PartitionCount: 3       ReplicationFactor: 1    Configs:
        Topic: bjstestkafka     Partition: 0    Leader: 0       Replicas: 0     Isr: 0
        Topic: bjstestkafka     Partition: 1    Leader: 0       Replicas: 0     Isr: 0
        Topic: bjstestkafka     Partition: 2    Leader: 0       Replicas: 0     Isr: 0`
```
###### 7.3 启动生产者（producer）
```
bin/kafka-console-producer.sh --broker-list localhost:9092 --topic bjstestkafka
```
显示 > 即可
###### 7.4 再开一个窗口启动消费者（consumer）
```
bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic bjstestkafka
```
###### 7.5 在生产者发送消息,消费者即可接收
###### 8 拉取kafka镜像
```
docker exec -ti kafka /bin/bash
```
